```md
# Vibecoding 详细方案：村级在线博物馆（照片为主 / GitHub Pages / 唯一无表头 CSV）

> 你要的核心体验：  
> **系列 = 文件夹名**；图片名是全站唯一 **数字 ID**（`1.jpg`…`N.jpg`）；  
> 除“系列归属”外，图片的一切信息都只从 **唯一 `metadata.csv`（无表头）**读取。  
> 每次更新只做两件事：**丢图进文件夹 + 更新 CSV**（不额外维护清单文件）。

---

## 0) 需求锁定（不再变更的硬规则）

### 0.1 图片规则
- 图片目录：`photos/<series_folder>/<id>.jpg`
- `<series_folder>`：系列名（中文可用，但必须一致）
- `<id>`：纯数字（例如 `1`、`2`、`3`…）
- **全站唯一**：同一个 `id` 不允许出现在任何两个系列里
- **永远 `.jpg`**

### 0.2 CSV 规则（唯一数据源）
- 仅一个文件：`data/metadata.csv`
- **无表头**
- CSV 的 `id` 是数字（例如 `1`），不带 `.jpg`
- 除系列归属外，页面展示的所有字段都来自 CSV

### 0.3 系列归属规则
- 图片属于哪个系列：只看图片所在文件夹名（`<series_folder>`）
- 系列标题默认展示为文件夹名（MVP 就够用）

---

## 1) 项目目录结构（建议固定）

```

/
index.html               # 首页：系列列表
series.html              # 系列页：照片墙
photo.html               # 详情页：单张照片

photos/
农具/
1.jpg
7.jpg
老街/
2.jpg
3.jpg
学校/
4.jpg

data/
metadata.csv           # 无表头：唯一元数据
manifest.json          # 自动生成（由 CI 生成，不手动编辑）

```

> `manifest.json` 是“自动产物”，**不需要你手动维护**，只要你上传图片和改 CSV，它会在部署时自动生成。  
> 这是为了满足“新增文件夹/新增图片自动出现在网站上”的需求（静态网站无法在浏览器端列目录）。

---

## 2) metadata.csv 数据契约（Data Contract）

### 2.1 每行固定 5 列（无表头）
列顺序固定为：

1) `id`（数字，唯一）  
2) `era`（年代/时间，例如 `1980s` / `1992` / `约1986`）  
3) `place`（组别/地点，例如 `三组` / `老街口`）  
4) `theme`（主题/物件，例如 `农具` / `婚礼`）  
5) `source`（来源，例如 `来自张三家` / `村委档案`）

### 2.2 例子（你的示例）
```

1,1980s,三组,农具,来自张三家

```

### 2.3 CSV 编码/字符规则
- 编码：UTF-8
- 分隔符：英文逗号 `,`
- 若字段内含逗号/引号，按标准 CSV 用英文双引号包裹；字段内双引号用 `""` 转义  
  示例：
  - `10,"约1980,春",三组,农具,来自张三家`
  - `11,1980s,三组,"农具（""打谷机""）",来自张三家`

### 2.4 空值策略（建议）
允许某些列为空，但必须保留列位（逗号不能省）：
- `12,1980s,,农具,来自张三家`  
渲染时空值使用占位：
- `待考` / `待补充`

---

## 3) 系统设计（关键：如何做到“只上传文件夹+CSV，网站自动更新”）

> 静态站的浏览器端 **无法**可靠列出 `photos/` 下的目录和图片文件。  
> 解决方案：在部署前由 CI/构建脚本扫描仓库，自动生成 `data/manifest.json`。

### 3.1 生成清单 manifest.json（自动）
**输入：**
- 文件系统：`photos/**/<id>.jpg`
- CSV：`data/metadata.csv`

**输出：**
- `data/manifest.json`（自动生成，包含系列列表、每张图的路径、并附带 CSV 元数据）

**manifest.json 建议结构（概念，不强制）：**
- `series[]`：每个系列（folder）
  - `name`：文件夹名
  - `count`：图片数量
  - `photos[]`：该系列下的图片（按 id 排序）
    - `id`
    - `src`：`photos/<series>/<id>.jpg`
    - `meta`：从 CSV 合并后的 `{era, place, theme, source}`

> 因为 `id` 全站唯一，`photo.html` 理论上只需要 `id` 就能定位到图片与系列。

### 3.2 校验（必须 Fail Fast，否则你更新一次可能全站乱）
生成 manifest 前/中做校验：

**必须失败（阻止部署）**
1) 图片 ID 重复：两个路径出现同名 `<id>.jpg`
2) CSV 中 ID 重复
3) CSV 中的 ID 找不到对应图片文件
4) 图片存在但 CSV 缺对应 ID 行（除非你明确要允许“先上图后补信息”，见 3.3）

**可选：允许“先上图后补信息”**
- 若你希望容错：第 4 条改成 Warning
- 渲染时对缺失 meta 的图片展示占位：`待考｜待考｜待补充｜待补充`

> 建议你先用严格模式（全通过才部署），能强迫数据一致，维护成本最低。

---

## 4) 前端页面规格（不写代码也要定清楚）

### 4.1 首页 index.html（系列列表）
**数据来源：** `data/manifest.json`

**展示内容（每个系列卡片）**
- 系列标题：文件夹名
- 照片数量：count
- 封面图：默认取该系列最小 id 或第一张（也可后续做更智能）

**交互**
- 点击系列卡片 → `series.html?series=<folder_name>`

### 4.2 系列页 series.html（照片墙）
**数据来源：** `manifest.json` 中对应 series

**照片排序**
- 按 id 数字升序（严格）

**缩略图策略（MVP）**
- 直接用原图也能跑通（你访问不大）
- 后续优化再引入 thumb（不改变数据规则）

**照片小标题（统一拼接规则）**
- 默认：`era｜place｜theme｜source`
- 缺字段则用占位（例如 `待考`）

**交互**
- 点击照片 → `photo.html?id=<id>`  
  （因为 id 全站唯一，不必传 series）

### 4.3 详情页 photo.html（单张展品）
**数据来源：** 通过 id 在 `manifest.json` 中定位图片对象

**展示**
- 大图（`photos/<series>/<id>.jpg`）
- 信息卡：`id / era / place / theme / source`
- “返回系列”按钮：回到该图所属系列页

---

## 5) GitHub Pages 部署与自动生成（CI 方案）

### 5.1 为什么需要 CI
- 你不想维护图片清单
- 你希望“上传新文件夹/新图片自动出现”
- 静态站无法在运行时列目录  
➡️ 所以必须在部署前“离线生成清单”

### 5.2 CI 流程（概念步骤）
1) checkout 仓库
2) 扫描 `photos/**.jpg` 生成图片列表（解析 series 与 id）
3) 读取 `data/metadata.csv` 生成 `id -> meta` 映射
4) 执行校验（Fail Fast）
5) 生成 `data/manifest.json`
6) 将站点（html + photos + data）部署到 GitHub Pages

> 注意：你仍然只需要上传图片和更新 CSV；manifest 完全自动生成。

---

## 6) 维护/更新工作流（你真正会用到的）

### 6.1 新增一张图片
- 把 `25.jpg` 放入目标系列文件夹：`photos/农具/25.jpg`
- 在 `data/metadata.csv` 追加一行：
  - `25,1990s,二组,农具,来自李四家`
- push 到 GitHub → CI 自动生成 manifest → Pages 自动更新

### 6.2 新增一个系列
- 新建文件夹：`photos/节庆/`
- 放入图片：`photos/节庆/88.jpg`
- CSV 新增行：`88,1998,老街口,舞龙,来自王五家`
- push → 网站自动出现“节庆”系列

### 6.3 修改描述
- 只改 `metadata.csv` 对应 id 那一行即可
- push → 自动更新展示文案

---

## 7) 边界条件与决策（提前写清楚避免返工）

### 7.1 系列文件夹名允许中文吗？
- 允许，但必须：
  - 全程一致（大小写/空格/符号不变）
  - 页面链接需要 URL 编码（实现层处理）

**推荐命名规范（可选）：**
- 中文：`农具` / `老街旧影`（直观）
- 或拼音：`nongju` / `laojie`（更稳）

### 7.2 id 是否允许跳号？
- 允许（如 1,2,5,9）
- 但推荐递增不复用，避免历史链接混乱

### 7.3 CSV 与图片不一致怎么办？
- 严格模式：直接构建失败，提示你修正
- 容错模式：允许缺 meta，但页面显示“待补充”

> 建议先严格模式；等你们数据稳定再考虑容错。

---

## 8) 测试/验收清单（上线前必过）

### 数据一致性
- [ ] `photos/` 下每张 jpg 的 id 在全站唯一
- [ ] `metadata.csv` 每个 id 也唯一
- [ ] 图片与 CSV 一一对应（严格模式下必须）

### 页面链路
- [ ] 首页能看到所有系列
- [ ] 系列页能看到该文件夹内所有图片
- [ ] 小标题按 `era｜place｜theme｜source` 正确显示
- [ ] 详情页能通过 id 正确定位图片与信息，并可返回系列

### 回归检查（更新后）
- [ ] 新增图片后：系列数量/图片数量自动更新
- [ ] 新增系列文件夹后：首页自动出现新系列
- [ ] 修改 CSV 后：文案及时更新

---

## 9) 后续增强（不改变你现在的数据规则）

### v1 性能优化（“压缩格式另算”的位置）
- 仍然保持：`id 唯一` + `CSV 唯一无表头` + `系列来自文件夹`
- 只在构建时额外生成：
  - `photos/<series>/<id>_thumb.jpg`（或单独目录）
  - 页面列表用 thumb，详情用原图或 web 图

### v2 体验增强
- 按 `era/theme/place/source` 过滤
- 搜索（输入关键词匹配 theme/source）
- “待补充清单”页面：列出缺字段的 id（帮助补档）

---

## 10) 你给的例子（最终对齐）
- 图片：`photos/农具/1.jpg`
- CSV 行：`1,1980s,三组,农具,来自张三家`

渲染结果：
- 系列：农具（文件夹名）
- 照片小标题：`1980s｜三组｜农具｜来自张三家`（来自 CSV）
- 详情页字段除“系列”外全部来自 CSV

---
```
